version: "3.0"

services:

  myauth-proxy-test-back-server:
    container_name: myauth-proxy-test-back-server
    image: nginx:1.19.6
    volumes:
      - .\test-back-nginx.conf:/etc/nginx/conf.d/default.conf

  myauth-image-based-test-server:
    container_name: myauth-image-based-test-server
    image: ozzyext/myauth-proxy:1.8.6
    environment:
      TARGET_SERVER: myauth-proxy-test-back-server
      SERVICE_SIGN: myauth-image-based-test-server
    depends_on:
      - myauth-proxy-test-back-server
    volumes:
      - .\image-based-test-server\test-config.lua:/app/configs/auth-config.lua
      - .\image-based-test-server\test-secrets.lua:/app/configs/auth-secrets.lua
      #- .\image-based-test-server\tmp.conf:/etc/nginx/conf.d/default.conf

  myauth-script-based-test-server:
    container_name: myauth-script-based-test-server
    image: myauth-script-based-test-server
    depends_on:
      - myauth-proxy-test-back-server
    volumes:
      - .\script-based-test-server\nginx.conf:/etc/nginx/conf.d/default.conf
      - .\script-based-test-server\test-config.lua:/app/configs/auth-config.lua
      - .\script-based-test-server\test-secrets.lua:/app/configs/auth-secrets.lua